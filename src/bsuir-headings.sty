\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{bsuir-headings}[2025/12/28 BSUIR headings and structure]

% Настройка заголовков через KOMA-Script

% Нумерация разделов: арабские цифры без точки в конце
\setcounter{secnumdepth}{4} % Разделы, подразделы, пункты, подпункты

% Форматирование заголовков разделов
\renewcommand\sectionformat{%
  \thesection\autodot\enskip
}
\renewcommand\subsectionformat{%
  \thesubsection\autodot\enskip
}
\renewcommand\subsubsectionformat{%
  \thesubsubsection\autodot\enskip
}
\renewcommand\paragraphformat{%
  \theparagraph\autodot\enskip
}

% Заголовки разделов: ПРОПИСНЫЕ буквы, без точки в конце
\setkomafont{section}{\normalfont\bfseries\Large\MakeUppercase}
\renewcommand\sectionformat{\thesection\enskip}

% Заголовки подразделов: строчные буквы, начиная с первой прописной
\setkomafont{subsection}{\normalfont\bfseries\large}
\renewcommand\subsectionformat{\thesubsection\enskip}

% Заголовки пунктов: жирный шрифт
\setkomafont{subsubsection}{\normalfont\bfseries\normalsize}
\renewcommand\subsubsectionformat{\thesubsubsection\enskip}

% Заголовки подпунктов: не жирный
\setkomafont{paragraph}{\normalfont\normalsize}
\renewcommand\paragraphformat{\theparagraph\enskip}

% Запрет переносов в заголовках
\RequirePackage{hyphenat}
\renewcommand\sectionformat{\thesection\enskip\nohyphenation}
\renewcommand\subsectionformat{\thesubsection\enskip\nohyphenation}
\renewcommand\subsubsectionformat{\thesubsubsection\enskip\nohyphenation}
\renewcommand\paragraphformat{\theparagraph\enskip\nohyphenation}

% Отступы между заголовками и текстом
% Между названием раздела, подраздела и текстом: одна пробельная строка
% Настройка висячей строки: вторая строка выравнивается по началу текста первой строки
\RedeclareSectionCommand[
  beforeskip=1\baselineskip,
  afterskip=1\baselineskip,
  indent=1.25cm,
  hanging=1.25cm
]{section}

\RedeclareSectionCommand[
  beforeskip=1\baselineskip,
  afterskip=1\baselineskip,
  indent=1.25cm
]{subsection}

\RedeclareSectionCommand[
  beforeskip=0pt,
  afterskip=0pt,
  indent=1.25cm
]{subsubsection}

\RedeclareSectionCommand[
  beforeskip=0pt,
  afterskip=0pt,
  indent=1.25cm
]{paragraph}

% Page break перед разделами
\RedeclareSectionCommand[
  beforeskip=1\baselineskip,
  afterskip=1\baselineskip,
  indent=1.25cm,
  runin=false
]{section}

% Содержание (tocbasic из KOMA-Script)
\RequirePackage{scrhack} % Для совместимости

% Настройка содержания
\setkomafont{sectionentry}{\normalfont}
\setkomafont{subsectionentry}{\normalfont}
\setkomafont{subsubsectionentry}{\normalfont}

% Выравнивание заголовков в содержании: смещение на 2 знака
% Явно включаем отточие (точки) в содержании
\RedeclareSectionCommand[
  tocentryindent=2em,
  tocentrynumwidth=2em,
  toclinefill=\TOCLineLeaderFill
]{section}

\RedeclareSectionCommand[
  tocentryindent=4em,
  tocentrynumwidth=2em,
  toclinefill=\TOCLineLeaderFill
]{subsection}

\RedeclareSectionCommand[
  tocentryindent=6em,
  tocentrynumwidth=2em,
  toclinefill=\TOCLineLeaderFill
]{subsubsection}

% Отточие в содержании
\renewcommand\@pnumwidth{2em}
\renewcommand\@tocrmarg{2.55em}

% Заголовок содержания: СОДЕРЖАНИЕ прописными буквами, полужирный, 14-16pt, по центру
\renewcommand\tableofcontents{%
  \begingroup
    \centering
    \bfseries
    \fontsize{14}{18}\selectfont
    \MakeUppercase{Содержание}%
    \par
    \vspace{\baselineskip}%
  \endgroup
  \@starttoc{toc}%
}

% Нумерация страниц: арабские цифры в правом нижнем углу, 10 мм от нижнего края
\RequirePackage{scrlayer-scrpage}
\clearpairofpagestyles
\ofoot*{\pagemark}
\setkomafont{pagenumber}{\normalfont}

% Настройка позиции номера страницы: 10 мм от нижнего края
% Подбирается экспериментально под 10мм от края при нижнем поле 20мм
\setlength{\footskip}{15mm}

% Титульный лист, реферат и задание: номер страницы не ставится
% (настраивается в документе через \thispagestyle{empty})

% Команда для ненумерованных разделов (Введение, Заключение и т.д.)
% Выравнивание по центру страницы без абзацного отступа
\makeatletter
\newcommand{\anonsection}[1]{%
  \cleardoublepage
  \phantomsection % Для правильной ссылки в PDF
  \begin{center}%
    \bfseries\Large\MakeUppercase{#1}%
  \end{center}%
  \addcontentsline{toc}{section}{#1}% Добавляем в содержание
  \vspace{\baselineskip}% Отступ после заголовка
  \@afterheading% Чтобы первый абзац вел себя как после заголовка
}
\makeatother

